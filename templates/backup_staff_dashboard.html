{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Staff Dashboard</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
  <!-- DataTables -->
  <link rel="stylesheet" href="{% static 'plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css' %}">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- JQVMap -->
  <link rel="stylesheet" href="{% static 'plugins/jqvmap/jqvmap.min.css' %}">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css' %}">
  <!-- summernote -->
  <link rel="stylesheet" href="{% static 'plugins/summernote/summernote-bs4.min.css' %}">
</head>
<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      
      <ul class="navbar-nav">
  
        <li class="nav-item d-none d-sm-inline-block">
          <a href="{% url 'home' %}" class="nav-link">Home</a>
        </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'register_student' %}" class="nav-link">register_student</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'register_staff' %}" class="nav-link">register_staff</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'edit_student' %}" class="nav-link">edit_student</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'edit_staff' %}" class="nav-link">edit_staff</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'delete_student' %}" class="nav-link">delete_student</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'delete_staff' %}" class="nav-link">delete_staff</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'view_students' %}" class="nav-link">view_students</a>
          </li>
      </ul>
    </nav>
    
  </div>
  <div class="wrapper">
    
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item d-none d-sm-inline-block">
          <a href="{% url 'view_staffs' %}" class="nav-link">view_staffs</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="{% url 'logout_request' %}" class="nav-link">logout</a>
        </li>
      </ul>
    </nav>
  </div>
  <div>
    
  </div>
  <!-- Main content -->
  <div class="wrapper">
    <section class="content">
    <div class="container-fluid">
      <!-- Small boxes (Stat box) -->
      <div class="row">
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-info">
            <div class="inner">
  
               <h3><div id="department_bonafides_received"></div></h3>
                
  
              <p>Bonafides Received</p>
            </div>
            <div class="icon">
              <i class="ion ion-bag"></i>
        </div>
      </div>
    </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-success">
            <div class="inner">
              <h3><div id="department_bonafides_pending"></div></h3>
              <p>Bonafides Pending</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-warning">
            <div class="inner">
            Name: <span id="name"></span><br>
            Staff Id: <span id="staffid"></span><br>
            Department: <span id="department"></span><br>
            Designation: <span id="designation"></span><br>
            College : <span id="college"></span>          
              
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-danger">
            <div class="inner">
              <h4>Personal Stat</h4>
            Approved Bonafides: <span id="bonafides_approved"></span><br>
            Rejected Bonafides: <span id="bonafides_rejected"></span> 

            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
          </div>
        </div>
      </div><br>
        <!-- ./col -->
        <div class="row">
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-warning">
            <div class="inner">
              <h3><div id="department_bonafides_approved"></div></h3>
              <p>Bonafides Approved</p>
            </div>
            <div class="icon">
              <i class="ion ion-person-add"></i>
            </div>
          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-danger">
            <div class="inner">
              <h3><div id="department_bonafides_rejected"></div></h3>
              <p>Bonafides Rejected</p>
            </div>
            <div class="icon">
              <i class="ion ion-pie-graph"></i>
            </div>
          </div>
        
          <!-- ./col -->
  
        </div>
        <div class="col-4">
          <button id="pending_requests" onclick="pending_bonafides(event)" class="btn btn-primary btn-block">Pending Requests</button>
        </div>
        <div class="col-4">
          <button  id="approved_requests" onclick="approved_bonafides(event)" class="btn btn-primary btn-block"> Approved Requests</button>
        </div>
        <div class="col-4">
          <button id="rejected_requests" onclick="rejected_bonafides(event)" class="btn btn-primary btn-block">Rejected Requests</button>
        </div>
        <!-- ./col -->
        
        <!-- ./col -->
        <!-- /.row -->
        </div>
        <!-- ./col -->
        
  
      </div>

      <!-- /.card -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title"><span id="type"></span> Bonafides</h3>
    </div>
    <!-- /.card-header -->
    <div class="card-body">
      <span id="bon_table"></span>
    </div>
    <!-- /.card-body -->
  </div>
  
        <!-- /.card -->
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  
<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'dist/js/adminlte.min.js' %}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{% static 'dist/js/demo.js' %}"></script>
<!-- DataTables  & Plugins -->
<script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/jszip/jszip.min.js' %}"></script>
<script src="{% static 'plugins/pdfmake/pdfmake.min.js' %}"></script>
<script src="{% static 'plugins/pdfmake/vfs_fonts.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>
<!-- jQuery UI 1.11.4 -->
<script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button)
</script>
<!-- ChartJS -->
<script src="{% static 'plugins/chart.js/Chart.min.js' %}"></script>
<!-- Sparkline -->
<script src="{% static 'plugins/sparklines/sparkline.js' %}"></script>
<!-- JQVMap -->
<script src="{% static 'plugins/jqvmap/jquery.vmap.min.js' %}"></script>
<script src="{% static 'plugins/jqvmap/maps/jquery.vmap.usa.js' %}"></script>
<!-- jQuery Knob Chart -->
<script src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
<!-- daterangepicker -->
<script src="{% static 'plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
<!-- Summernote -->
<script src="{% static 'plugins/summernote/summernote-bs4.min.js' %}"></script>
<!-- overlayScrollbars -->
<script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="{% static 'dist/js/pages/dashboard.js' %}"></script>
<script>
  $(document).ready(function () {
       data_getter();
   });
 
function data_getter() {
     // e.preventDefault();
     $.ajax({
         type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
         url         : "{% url 'staff_dashboard_data' %}", // the url where we want to POST
         // data        : $('#form').serialize(), // our form data
         dataType    : 'json', // what type of data do we expect back from the server
         success     : successFunction
     });
 }

 function successFunction(res_obj) {
    
     if (res_obj.status === 'success') {
      document.getElementById("name").innerText=res_obj.data[1];
      document.getElementById("staffid").innerText=res_obj.data[0];
      document.getElementById("department").innerText=res_obj.data[2];
      document.getElementById("designation").innerText=res_obj.data[3];
      document.getElementById("bonafides_approved").innerText=res_obj.data[4];
      document.getElementById("bonafides_rejected").innerText=res_obj.data[5];
      document.getElementById("department_bonafides_received").innerText=res_obj.data[6];
      document.getElementById("department_bonafides_approved").innerText=res_obj.data[7];
      document.getElementById("department_bonafides_rejected").innerText=res_obj.data[9];
      document.getElementById("department_bonafides_pending").innerText=res_obj.data[8];
      document.getElementById("college").innerText=res_obj.data[10];
      pending_bonafides();
     }
     else{
      $("#type").empty();
      $("#type").append(res_obj.msg);
     }
 }

 function pending_bonafides(){
  $.ajax({
    type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
    url         : "{% url 'pending_requests_data' %}", // the url where we want to POST
    // data        : $('#form').serialize(), // our form data
    dataType    : 'json', // what type of data do we expect back from the server
    success     : pen_tab
});
 }

 function pen_tab(res_obj){
  if (res_obj.status === 'success') { 
 
    const bonafides= res_obj.data;//bonafides data store
    
       var html_text=`
       <table id="table_id" class="table table-bordered table-striped">
         <thead>
           <tr>
             <th>Roll Number</th>
             <th>Student Name</th>
             <th>Department</th>
             <th>Year</th>
             <th>Section</th>
             <th>Reason For Request</th>
             <th>Date Of Request</th>
             <th>Approve/Reject</th>
           </tr>
         </thead>
         <tbody>
       `;

        for(var i=0;i<bonafides.length;i++){
         html_text+="<tr>";

         for(var j=0;j<bonafides[i].length-1;j++){
           html_text+="<td>";
            html_text+=bonafides[i][j]; 
           html_text+="</td>" ;
           
         } 
         
         html_text+=`<td><button onclick="confirm('Are you Sure To Approve?') && approve(`;
          html_text+=bonafides[i][7];
          html_text+=`)" class="btn btn-block btn-success">Approve</button>`;
          html_text+=`<button onclick="confirm('Are you Sure To Reject?') && reject(`;
          html_text+=bonafides[i][7];
          html_text+=`)" class="btn btn-block btn-danger">Reject</button></td>`;
        
        } 
        html_text+=`</tbody>
        <tfoot>
          <tr>
            <th>Roll Number</th>
             <th>Student Name</th>
             <th>Department</th>
             <th>Year</th>
             <th>Section</th>
             <th>Reason For Request</th>
             <th>Date Of Request</th>
             <th>Approve/Reject</th>
          </tr>
          </tfoot></table>`
        $("#type").empty();
        $("#type").append("Pending");
        $("#bon_table").empty();
        $("#bon_table").append(html_text);
        data_table();
   }
   else{
    $("#bon_table").empty();
    $("#bon_table").append(res_obj.msg);
   }
 }

 function approved_bonafides(){
  $.ajax({
    type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
    url         : "{% url 'approved_requests_data' %}", // the url where we want to POST
    // data        : $('#form').serialize(), // our form data
    dataType    : 'json', // what type of data do we expect back from the server
    success     : app_tab
});
}

function app_tab(res_obj){
  if (res_obj.status === 'success') { 
 
    const bonafides= res_obj.data;//bonafides data store
    
       var html_text=`
       <table id="table_id" class="table table-bordered table-striped">
         <thead>
           <tr>
             <th>Roll Number</th>
             <th>Student Name</th>
             <th>Department</th>
             <th>Year</th>
             <th>Section</th>
             <th>Reason For Request</th>
             <th>Date Of Request</th>
             <th>Date Handled</th>
             <th>Handled By</th>
           </tr>
         </thead>
         <tbody>
       `;
      
     
        for(var i=0;i<bonafides.length;i++){
         html_text+="<tr>";

         for(var j=0;j<bonafides[i].length;j++){
           html_text+="<td>";
            html_text+=bonafides[i][j]; 
           html_text+="</td>" ;
           
         }  
         html_text+="</tr>";
      
        } 
        html_text+=`</tbody>
        <tfoot>
          <tr>
            <th>Roll Number</th>
             <th>Student Name</th>
             <th>Department</th>
             <th>Year</th>
             <th>Section</th>
             <th>Reason For Request</th>
             <th>Date Of Request</th>
             <th>Date Handled</th>
             <th>Handled By</th>
          </tr>
          </tfoot></table>`
        $("#type").empty();
        $("#type").append("Approved");
        $("#bon_table").empty();
        $("#bon_table").append(html_text);
        data_table();
   }
   else{
    $("#bon_table").empty();
    $("#bon_table").append(res_obj.msg);
   }
}

function rejected_bonafides(){
  $.ajax({
    type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
    url         : "{% url 'rejected_requests_data' %}", // the url where we want to POST
    // data        : $('#form').serialize(), // our form data
    dataType    : 'json', // what type of data do we expect back from the server
    success     : rej_tab
});
}

function rej_tab(res_obj){
  if (res_obj.status === 'success') { 
 
    const bonafides= res_obj.data;//bonafides data store
    
       var html_text=`
       <table id="table_id" class="table table-bordered table-striped">
         <thead>
           <tr>
             <th>Roll Number</th>
             <th>Student Name</th>
             <th>Department</th>
             <th>Year</th>
             <th>Section</th>
             <th>Reason For Request</th>
             <th>Date Of Request</th>
             <th>Date Handled</th>
             <th>Handled By</th>
           </tr>
         </thead>
         <tbody>
       `;
      
     
        for(var i=0;i<bonafides.length;i++){
         html_text+="<tr>";

         for(var j=0;j<bonafides[i].length;j++){
           html_text+="<td>";
            html_text+=bonafides[i][j]; 
           html_text+="</td>" ;
           
         }  
         html_text+="</tr>";
      
        } 
        html_text+=`</tbody>
        <tfoot>
          <tr>
            <th>Roll Number</th>
             <th>Student Name</th>
             <th>Department</th>
             <th>Year</th>
             <th>Section</th>
             <th>Reason For Request</th>
             <th>Date Of Request</th>
             <th>Date Handled</th>
             <th>Handled By</th>
          </tr>
          </tfoot>
      </table>`
        $("#type").empty();
        $("#type").append("Rejected");
        $("#bon_table").empty();
        $("#bon_table").append(html_text);
        data_table();
   }
   else{
    $("#bon_table").empty();
    $("#bon_table").append(res_obj.msg);
   }
}


function approve(bonafide_id){
    $.ajax({
    type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
    url         : "{% url 'approve_request' %}", // the url where we want to POST
    data        : {bonafide_id:bonafide_id, csrfmiddlewaretoken: '{{ csrf_token }}'}, // our form data
    dataType    : 'json', // what type of data do we expect back from the server
    success     : app_func
});
}

function app_func(res_obj){

    if(res_obj.status=="success"){
        alert(res_obj.msg);
        data_getter();
    }
    else{
        alert(res_obj.msg);
    }
}


function reject(bonafide_id){
    $.ajax({
    type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
    url         : "{% url 'reject_request' %}", // the url where we want to POST
    data        : {bonafide_id:bonafide_id, csrfmiddlewaretoken: '{{ csrf_token }}'}, // our form data
    dataType    : 'json', // what type of data do we expect back from the server
    success     : rej_func
});
}

function rej_func(res_obj){
    if(res_obj.status=="success"){
        alert(res_obj.msg);
        data_getter();
    }
    else{
        alert(res_obj.msg);
    }
}

function data_table() {
  $("#table_id").DataTable({
    "responsive": true, "lengthChange": false, "autoWidth": false,
    "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
  }).buttons().container().appendTo('#table_id_wrapper .col-md-6:eq(0)');
}

 </script>
</body>
</html>