{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Faculty Dashboard</title>
  <link rel="icon" href="{% static 'dist/img/pec-logo-pic.png' %}" type="png">

  <!-- Google Font: Ubuntu -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,500;1,700&display=swap"
    rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="{% static 'https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css' %}">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- JQVMap -->
  <link rel="stylesheet" href="{% static 'plugins/jqvmap/jqvmap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
  <!-- summernote -->
  <link rel="stylesheet" href="{% static 'plugins/summernote/summernote-bs4.min.css' %}">

  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css">
</head>

<body class=" sidebar-collapse">
  <!-- Site wrapper -->
  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-black navbar-dark">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item d-none d-sm-inline-block">
          <a href="{% url 'home' %}" class="nav-link">Home</a>
        </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'register_student' %}" class="nav-link">Register Student</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'edit_student' %}" class="nav-link">Edit Student</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'delete_student' %}" class="nav-link">Delete Student</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'view_students' %}" class="nav-link">View Students</a>
          </li>
          <span id="admin_urls"></span>
      </ul>

      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a href="{% url 'logout_request' %}" type="button" class="btn btn-danger">Logout</a>
        </li>
      </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">Faculty Dashboard</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a id="breadcrumb-home" href="{% url 'home' %}">Home</a></li>
                <li class="breadcrumb-item active">Faculty Dashboard</li>
              </ol>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          <!-- Small boxes (Stat box) -->
          <div class="row">

            <div class="col-lg-4 col-6">
              <div class="small-box bg-warning">
                <div class="inner">
                  <h3><div id="department_bonafides_pending"></div></h3>
                  <p>Pending Requests</p>
                </div>
                <div class="icon">
                  <i class="fas fa-user-clock"></i>
                </div>
                <a type='submit' onclick="pending_bonafides(event)" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
              </div>
            </div>
            <div class="col-lg-4 col-6">
              <div class="small-box bg-success">
                <div class="inner">
                  <h3><div id="department_bonafides_approved"></div></h3>
                  <p>Approved Requests</p>
                </div>
                <div class="icon">
                  <i class="fas fa-user-check"></i>
                </div>
                <a type='submit' onclick="approved_bonafides(event)" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
              </div>
            </div>
            <div class="col-lg-4 col-6">
              <div class="small-box bg-danger">
                <div class="inner">
                  <h3><div id="department_bonafides_rejected"></div></h3>
                  <p>Rejected Requests</p>
                </div>
                <div class="icon">
                  <i class="fas fa-user-times"></i>
                </div>
                <a type='submit' onclick="rejected_bonafides(event)" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
              </div>
            </div>

            <div class="col-lg-6 col-6">
              <div class="small-box bg-dark">
                <div class="inner">
                  <div class="row">
                    <div class="col-6">
                      <h3><span id="bonafides_approved"></span></h3>
                      <p> Approved by You</p>
                    </div>
                    <div class="col-6">
                      <h3><span id="bonafides_rejected"></span></h3>
                      <p> Rejected by You</p>
                    </div>
                  </div>
                </div>
                <div class="icon">
                  <i class="fas fa-user-circle"></i>
                </div>
                <!-- <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a> -->
              </div>
            </div> 
            <div class="col-lg-6 col">
              <!-- small box -->
              <div class="small-box bg-secondary">
                <div class="inner">
                  <div class="row">
                    <div class="col-5">
                      Logged in as,<br>
                      Name: &nbsp&nbsp <span id="name"></span><br>
                      Staff Id: &nbsp&nbsp   <span id="staffid"></span><br>
                      Department: &nbsp&nbsp <span id="department"></span><br>
                    </div>
                    <div class="col-7">
                      <br>
                      Designation: &nbsp&nbsp<span id="designation"></span><br>
                      College : &nbsp&nbsp   <span id="college"></span><br>
                      Email : &nbsp&nbsp <span id="email"></span>
                    </div>
                  </div>
                </div>
                <div class="icon">
                  <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <!-- <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a> -->
              </div>
            </div>

          </div>
          <div class="col-sm-12">
            <h4 class="text-center alert alert-secondary"><span id="type"></span> Bonafides  --  <span id="department1"></span> Department</h3></h4>
            <div class="wrapper-editor">
              <span id="bon_table"></span>
              <!-- <table id="example" class="hover display nowrap" style="width:100%"> -->
            </div>
          </div>

        </div><!-- /.container-fluid -->
      </section>
      <!-- /.content -->
    </div>
   
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

  <!-- jQuery -->
  <script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button)
  </script>
  <!-- Bootstrap 4 -->
  <script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <!-- ChartJS -->
  <script src="{% static 'plugins/chart.js/Chart.min.js' %}"></script>
  <!-- Sparkline -->
  <script src="{% static 'plugins/sparklines/sparkline.js' %}"></script>
  <!-- JQVMap -->
  <script src="{% static 'plugins/jqvmap/jquery.vmap.min.js' %}"></script>
  <script src="{% static 'plugins/jqvmap/maps/jquery.vmap.usa.js' %}"></script>
  <!-- jQuery Knob Chart -->
  <script src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
  <!-- daterangepicker -->
  <script src="{% static 'plugins/moment/moment.min.js' %}"></script>
  <script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
  <!-- Summernote -->
  <script src="{% static 'plugins/summernote/summernote-bs4.min.js' %}"></script>
  <!-- overlayScrollbars -->
  <script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
  <!-- AdminLTE App -->
  <script src="{% static 'dist/js/adminlte.js' %}"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="{% static 'dist/js/demo.js' %}"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <script src="{% static 'dist/js/pages/dashboard.js' %}"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>


    
  <script>
    $(document).ready(function () {
         data_getter();
     });
   
  function data_getter() {
       // e.preventDefault();
       $.ajax({
           type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
           url         : "{% url 'staff_dashboard_data' %}", // the url where we want to POST
           // data        : $('#form').serialize(), // our form data
           dataType    : 'json', // what type of data do we expect back from the server
           success     : successFunction
       });
   }
  
   function successFunction(res_obj) {
      
       if (res_obj.status === 'success') {
        document.getElementById("name").innerText=res_obj.data[1];
        document.getElementById("staffid").innerText=res_obj.data[0];
        document.getElementById("department").innerText=res_obj.data[2];
        document.getElementById("department1").innerText=res_obj.data[2];
        document.getElementById("designation").innerText=res_obj.data[3];
        document.getElementById("bonafides_approved").innerText=res_obj.data[4];
        document.getElementById("bonafides_rejected").innerText=res_obj.data[5];
        document.getElementById("department_bonafides_approved").innerText=res_obj.data[7];
        document.getElementById("department_bonafides_rejected").innerText=res_obj.data[9];
        document.getElementById("department_bonafides_pending").innerText=res_obj.data[8];
        document.getElementById("college").innerText=res_obj.data[10];
        document.getElementById("email").innerText=res_obj.data[12];
        pending_bonafides();
        //document.getElementById("department_bonafides_received").innerText=res_obj.data[6];
        if(res_obj.data[11]){
          html_text=`
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'register_staff' %}" class="nav-link">Register Staff</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'edit_staff' %}" class="nav-link">Edit Staff</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'delete_staff' %}" class="nav-link">Delete Staff</a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'view_staffs' %}" class="nav-link">View Staffs</a>
          </li>
          `
          $("#admin_urls").empty();
          $("#admin_urls").append(html_text);
        }

       }
       else{
        $("#type").empty();
        $("#type").append(res_obj.msg);
       }
   }
  
   function pending_bonafides(){
    $.ajax({
      type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
      url         : "{% url 'pending_requests_data' %}", // the url where we want to POST
      // data        : $('#form').serialize(), // our form data
      dataType    : 'json', // what type of data do we expect back from the server
      success     : pen_tab
  });
   }
  
   function pen_tab(res_obj){
    if (res_obj.status === 'success') { 
   
      const bonafides= res_obj.data;//bonafides data store
      
         var html_text=`
         <table id="table_id" class="hover display nowrap" style="width:100%">
           <thead>
             <tr>
               <th>Roll Number</th>
               <th>Student Name</th>
               <th>Department</th>
               <th>Year</th>
               <th>Section</th>
               <th>Reason For Request</th>
               <th>Date Of Request</th>
               <th>Approve/Reject</th>
             </tr>
           </thead>
           <tbody>
         `;
  
          for(var i=0;i<bonafides.length;i++){
           html_text+="<tr>";
  
           for(var j=0;j<bonafides[i].length-1;j++){
             html_text+="<td>";
              html_text+=bonafides[i][j]; 
             html_text+="</td>" ;
             
           } 
           
           html_text+=`<td><button onclick="confirm('Are you Sure To Approve?') && approve(`;
            html_text+=bonafides[i][7];
            html_text+=`)" class="btn btn-block btn-success">Approve</button>`;
            html_text+=`<button onclick="confirm('Are you Sure To Reject?') && reject(`;
            html_text+=bonafides[i][7];
            html_text+=`)" class="btn btn-block btn-danger">Reject</button></td>`;
          
          } 
          html_text+=`</tbody>
          <tfoot>
            <tr>
              <th>Roll Number</th>
               <th>Student Name</th>
               <th>Department</th>
               <th>Year</th>
               <th>Section</th>
               <th>Reason For Request</th>
               <th>Date Of Request</th>
               <th>Approve/Reject</th>
            </tr>
            </tfoot></table>`
          $("#type").empty();
          $("#type").append("Pending");
          $("#bon_table").empty();
          $("#bon_table").append(html_text);
          data_table();
     }
     else{
      $("#bon_table").empty();
      $("#bon_table").append(res_obj.msg);
     }
   }
  
   function approved_bonafides(){
    $.ajax({
      type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
      url         : "{% url 'approved_requests_data' %}", // the url where we want to POST
      // data        : $('#form').serialize(), // our form data
      dataType    : 'json', // what type of data do we expect back from the server
      success     : app_tab
  });
  }
  
  function app_tab(res_obj){
    if (res_obj.status === 'success') { 
   
      const bonafides= res_obj.data;//bonafides data store
      
         var html_text=`
         <table id="table_id" class="hover display nowrap" style="width:100%">
           <thead>
             <tr>
               <th>Roll Number</th>
               <th>Student Name</th>
               <th>Department</th>
               <th>Year</th>
               <th>Section</th>
               <th>Reason For Request</th>
               <th>Date Of Request</th>
               <th>Date Handled</th>
               <th>Handled By</th>
             </tr>
           </thead>
           <tbody>
         `;
        
       
          for(var i=0;i<bonafides.length;i++){
           html_text+="<tr>";
  
           for(var j=0;j<bonafides[i].length;j++){
             html_text+="<td>";
              html_text+=bonafides[i][j]; 
             html_text+="</td>" ;
             
           }  
           html_text+="</tr>";
        
          } 
          html_text+=`</tbody>
          <tfoot>
            <tr>
              <th>Roll Number</th>
               <th>Student Name</th>
               <th>Department</th>
               <th>Year</th>
               <th>Section</th>
               <th>Reason For Request</th>
               <th>Date Of Request</th>
               <th>Date Handled</th>
               <th>Handled By</th>
            </tr>
            </tfoot></table>`
          $("#type").empty();
          $("#type").append("Approved");
          $("#bon_table").empty();
          $("#bon_table").append(html_text);
          data_table();
     }
     else{
      $("#bon_table").empty();
      $("#bon_table").append(res_obj.msg);
     }
  }
  
  function rejected_bonafides(){
    $.ajax({
      type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
      url         : "{% url 'rejected_requests_data' %}", // the url where we want to POST
      // data        : $('#form').serialize(), // our form data
      dataType    : 'json', // what type of data do we expect back from the server
      success     : rej_tab
  });
  }
  
  function rej_tab(res_obj){
    if (res_obj.status === 'success') { 
   
      const bonafides= res_obj.data;//bonafides data store
      
         var html_text=`
         <table id="table_id" class="hover display nowrap" style="width:100%">
           <thead>
             <tr>
               <th>Roll Number</th>
               <th>Student Name</th>
               <th>Department</th>
               <th>Year</th>
               <th>Section</th>
               <th>Reason For Request</th>
               <th>Date Of Request</th>
               <th>Date Handled</th>
               <th>Handled By</th>
             </tr>
           </thead>
           <tbody>
         `;
        
       
          for(var i=0;i<bonafides.length;i++){
           html_text+="<tr>";
  
           for(var j=0;j<bonafides[i].length;j++){
             html_text+="<td>";
              html_text+=bonafides[i][j]; 
             html_text+="</td>" ;
             
           }  
           html_text+="</tr>";
        
          } 
          html_text+=`</tbody>
          <tfoot>
            <tr>
              <th>Roll Number</th>
               <th>Student Name</th>
               <th>Department</th>
               <th>Year</th>
               <th>Section</th>
               <th>Reason For Request</th>
               <th>Date Of Request</th>
               <th>Date Handled</th>
               <th>Handled By</th>
            </tr>
            </tfoot>
        </table>`
          $("#type").empty();
          $("#type").append("Rejected");
          $("#bon_table").empty();
          $("#bon_table").append(html_text);
          data_table();
     }
     else{
      $("#bon_table").empty();
      $("#bon_table").append(res_obj.msg);
     }
  }
  
  
  function approve(bonafide_id){
      $.ajax({
      type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
      url         : "{% url 'approve_request' %}", // the url where we want to POST
      data        : {bonafide_id:bonafide_id, csrfmiddlewaretoken: '{{ csrf_token }}'}, // our form data
      dataType    : 'json', // what type of data do we expect back from the server
      success     : app_func
  });
  }
  
  function app_func(res_obj){
  
      if(res_obj.status=="success"){
          alert(res_obj.msg);
          data_getter();
      }
      else{
          alert(res_obj.msg);
      }
  }
  
  
  function reject(bonafide_id){
      $.ajax({
      type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
      url         : "{% url 'reject_request' %}", // the url where we want to POST
      data        : {bonafide_id:bonafide_id, csrfmiddlewaretoken: '{{ csrf_token }}'}, // our form data
      dataType    : 'json', // what type of data do we expect back from the server
      success     : rej_func
  });
  }
  
  function rej_func(res_obj){
      if(res_obj.status=="success"){
          alert(res_obj.msg);
          data_getter();
      }
      else{
          alert(res_obj.msg);
      }
  }
  
  function data_table() {
    $("#table_id").DataTable({
      "scrollX": true,
        dom: 'Bfrtip',
        buttons: [
          'copy', 'csv', 'excel', 'pdf', 'print',
        ]
    });
  }
  
  </script>
</body>

</html>